<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>OX QUIZ GAME</title>

<style>
    body {
        margin: 0;
        background: #000;
        font-family: 'Orbitron', sans-serif;
        color: #fff;
        text-align: center;
    }

    .login-box, .quiz-box {
        width: 440px;
        margin: 150px auto;
        padding: 40px;
        background: rgba(20, 20, 20, 0.85);
        border-radius: 15px;
        box-shadow: 0 0 20px #0ff;
    }

    input {
        width: 90%;
        padding: 14px;
        font-size: 18px;
        border-radius: 10px;
        border: none;
        margin-bottom: 20px;
        text-align: center;
    }

    button {
        width: 80%;
        padding: 15px;
        font-size: 18px;
        background: linear-gradient(90deg, #00e5ff, #0066ff);
        border: none;
        border-radius: 10px;
        cursor: pointer;
        color: #fff;
        box-shadow: 0 0 20px #00e5ff;
        margin-top: 10px;
    }

    #question {
        font-size: 24px;
        margin: 20px 0;
        min-height: 80px;
    }

    .ox-btn {
        display: inline-block;
        margin: 20px;
        font-size: 60px;
        cursor: pointer;
        transition: 0.2s;
    }
    .ox-btn:hover {
        transform: scale(1.2);
    }

    .correct {
        border: 4px solid #0f0;
        animation: glow 1s ease-out;
    }
    .wrong {
        border: 4px solid #f00;
        animation: glowRed 1s ease-out;
    }
    @keyframes glow {
        0% { box-shadow: 0 0 20px #0f0; }
        100% { box-shadow: 0 0 0px transparent; }
    }
    @keyframes glowRed {
        0% { box-shadow: 0 0 20px #f00; }
        100% { box-shadow: 0 0 0px transparent; }
    }

    #timer {
        font-size: 30px;
        margin-top: 10px;
        color: #0ff;
    }
</style>
</head>
<body>

<div id="login" class="login-box">
    <h1>OX QUIZ GAME</h1>
    <input type="text" id="username" placeholder="이름 입력">
    <button onclick="login()">시작하기</button>
    <p id="login-status" style="color:red;"></p>
</div>

<div id="quiz" class="quiz-box" style="display:none;">
    <h2 id="playerName"></h2>
    <p>점수: <span id="score">0</span></p>
    <p>진행: <span id="count">0</span> / 100</p>
    <div id="timer">20</div>
    <div id="question"></div>

    <div>
        <span class="ox-btn" onclick="submitAnswer('O')">⭕</span>
        <span class="ox-btn" onclick="submitAnswer('X')">❌</span>
    </div>

    <button onclick="nextQuiz()">다음 문제</button>
</div>

<script>
/* ★★★ 반드시 수정해야 하는 Apps Script 배포 URL ★★★ */
const API = "https://script.google.com/macros/s/AKfycbxOHZ6zztNqD5s5loXdZnb3vFX86jhTSYncjKjIIO66vX8ETevLN_2tneD32dIKtddnSw/exec";

/* JSONP 헬퍼 */
function jsonp(url, callback) {
    const cbName = "cb_" + Math.random().toString(36).substring(2, 15);
    window[cbName] = function(data) {
        callback(data);
        document.body.removeChild(script);
        delete window[cbName];
    };

    const script = document.createElement("script");
    script.src = url + "&callback=" + cbName;
    document.body.appendChild(script);
}

/*************** 게임 전역 변수 ***************/
let playerName = "";
let currentQuizId = null;
let timerInterval = null;
let timeLeft = 20;

/*************** 로그인 ***************/
function login() {
    playerName = document.getElementById("username").value.trim();
    if (!playerName) {
        document.getElementById("login-status").innerText = "이름을 입력하세요";
        return;
    }

    const url = `${API}?type=login&name=${encodeURIComponent(playerName)}`;

    jsonp(url, data => {
        if (data.error) {
            document.getElementById("login-status").innerText = data.error;
            return;
        }

        document.getElementById("login").style.display = "none";
        document.getElementById("quiz").style.display = "block";

        document.getElementById("playerName").innerText = data.name;
        document.getElementById("score").innerText = data.score;
        document.getElementById("count").innerText = data.count;

        nextQuiz();
    });
}

/*************** 문제 가져오기 ***************/
function nextQuiz() {
    clearInterval(timerInterval);
    timeLeft = 20;

    const url = `${API}?type=getQuiz`;

    jsonp(url, data => {
        if (data.error) return;

        currentQuizId = data.id;
        document.getElementById("question").innerText = data.question;
        startTimer();
    });
}

/*************** 타이머 ***************/
function startTimer() {
    document.getElementById("timer").innerText = timeLeft;

    timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").innerText = timeLeft;

        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            submitAnswer("TIMEOUT");
        }
    }, 1000);
}

/*************** 정답 제출 ***************/
function submitAnswer(choice) {
    clearInterval(timerInterval);

    const url =
      `${API}?type=submitAnswer` +
      `&name=${encodeURIComponent(playerName)}` +
      `&quizId=${currentQuizId}` +
      `&choice=${choice}`;

    jsonp(url, data => {
        if (data.error) {
            alert("오류: " + data.error);
            return;
        }

        // UI 업데이트
        document.getElementById("score").innerText = data.newScore;
        document.getElementById("count").innerText = data.count;

        if (data.gameOver) {
            alert(`100문제 완료! 점수: ${data.newScore}`);
        }

        // 정답 애니메이션
        if (choice === data.correctAnswer) {
            document.getElementById("question").classList.add("correct");
        } else {
            document.getElementById("question").classList.add("wrong");
        }

        setTimeout(() => {
            document.getElementById("question").classList.remove("correct");
            document.getElementById("question").classList.remove("wrong");
        }, 1000);
    });
}
</script>

</body>
</html>
